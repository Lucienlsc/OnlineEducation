<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>登录页 | Log in</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../static/plugins/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../static/dist/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../static/dist/css/adminlte.min.css">

</head>
<body class="" background="../static/dist/img/bg-slider-3.png" style=" background-repeat:no-repeat ;background-size:100% 100%; background-attachment: fixed;">
<div class="login-box" style="margin: 0 auto;margin-top: 5%">
  <div class="login-logo">
    <b>CLEVER在线学习平台</b>
  </div>
  <!-- /.login-logo -->
  <div class="card" style="box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15)">
    <div class="card-body login-card-body">
      <p class="login-box-msg"><img src="../static/dist/img/logo.png" alt=""></p>

      <form action="##" onsubmit="return false;" method="post">
        <div class="input-group mb-3">

          <input type="text" id="userName" class="form-control" placeholder="请输入学生学号/教师工号/管理账号">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fa fa-user "></span>
            </div>
          </div>
        </div>
        <div class="input-group mb-3">
          <input type="password" id="password" class="form-control" placeholder="请输入密码">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fa fa-lock"></span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label  class="control-label">用户类型:</label>
          <div class="btn-group btn-group-toggle" data-toggle="buttons" style="width: 100%">
            <label class="btn btn-secondary active" style="width: 50%">
              <input type="radio" name="userType" id="option1" value="1" autocomplete="off" checked="checked" > 学生
            </label>
            <label class="btn btn-secondary" style="width: 50%">
              <input type="radio" name="userType" id="option2" value="2" autocomplete="off" > 教师
            </label>
            <label class="btn btn-secondary" style="width: 50%">
              <input type="radio" name="userType" id="option3" value="3" autocomplete="off" > 管理员
            </label>
          </div>
        </div>


        <div class="row" style="width: 320px">
          <div class="col">
            <p class="mb-1">
              <a href="#" onclick="forgetPassword()">忘记密码</a>
            </p>
            <p class="mb-0">
              <a href="#" class="text-center" onclick="registered()">学生注册</a>
            </p>
          </div>
          <!-- /.col -->
          <div class="col-4">
            <button type="submit" onclick="login()" class="btn btn-primary" style="margin-left: 20px;width: 80px;margin-top: 5px">登录</button>
          </div>
          <!-- /.col -->
        </div>
      </form>

    </div>
    <!-- /.login-card-body -->
  </div>

  <div class="content">
    <!-- 模态框（Modal） -->
    <div class="modal fade" id="modalRegister" tabindex="-1" role="dialog" aria-labelledby="modalRegisterabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
            <!--                        <h6 class="modal-title" id="modalAddTitle">用户添加</h6>-->
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <div class="alert alert-danger add-error-info">错误信息展示栏。</div>
              </div>
              <div class="form-group">
                <label for="userNameNew" class="control-label">姓名:</label>
                <input type="text" class="form-control" id="userNameNew" autocomplete="off">
              </div>
              <div class="form-group">
                <label for="passwordNew" class="control-label">密码:</label>
                <input type="password" class="form-control" id="passwordNew">
              </div>
              <div class="form-group">
                <label for="studentIDNew" class="control-label">学号:</label>
                <input type="text" class="form-control" id="studentIDNew">
              </div>
              <div class="form-group">
                <label  class="control-label">性别:</label>
                <div class="btn-group btn-group-toggle" data-toggle="buttons" style="width: 100%">
                  <label class="btn btn-secondary" id="sex1" style="width: 50%">
                    <input type="radio" name="userSex" id="option1New" value="男" autocomplete="off" checked="" > 男
                  </label>
                  <label class="btn btn-secondary" id="sex2" style="width: 50%">
                    <input type="radio" name="userSex" id="option2New" value="女" autocomplete="off" > 女
                  </label>
                </div>
              </div>
              <div class="form-group">
                <label for="studentClassNew" class="control-label">班级:</label>
                <input type="text" class="form-control" id="studentClassNew">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-primary" id="saveButton">确认</button>
          </div>
        </div>
      </div>
    </div>
    <!-- /.modal -->
  </div>
</div>
<!-- /.login-box -->

<!-- jQuery -->
<script src="../static/plugins/jquery/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="../static/plugins/jQueryUI/jquery-ui.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../static/plugins/sweetalert/sweetalert.min.js"></script>
<script src="../static/dist/js/public.js"></script>
<script src="../static/dist/js/adminlte.js"></script>
<script type="text/javascript">
  function login() {
    var userName = $("#userName").val();
    var password = $("#password").val();
    var userType = $("input[name='userType']:checked").val();
    console.log(userType+","+userName+","+password);

    if(userType == 1){
      var user_url = "students/login";
      var data = {"studentID":userName,"studentPassword":password}  //这里的参数名要和entity里的字符名一样，@RequestBody才能自动把数据传进去
    }
    if(userType == 2){
      var user_url = "teachers/login";
      var data = {"teaJobNumber":userName,"teacherPassword":password}  //这里的参数名要和entity里的字符名一样，@RequestBody才能自动把数据传进去
    }
    if(userType == 3){
      var user_url = "admins/login";
      var data = {"adminName":userName,"adminPassword":password}  //这里的参数名要和entity里的字符名一样，@RequestBody才能自动把数据传进去
    }
    $.ajax({
      type:"POST",//方法类型
      dataType:"json",//预期服务器返回的数据类型
      url:user_url,
      contentType:"application/json; charset=utf-8",
      data:JSON.stringify(data),
      success:function (result) {
        if (result.resultCode == 200){
          if(userType == 1){
            setCookie("token",result.data.studentToken);
            localStorage.setItem("userName",userName);
            window.location.href = "index-login.html";    //页面跳转
          }
          if(userType == 2){
            setCookie("token",result.data.teacherToken);
            localStorage.setItem("userName",userName);
            window.location.href = "teacher/teacherStudent.html";    //页面跳转
          }
          if(userType == 3){
            setCookie("token",result.data.adminToken)
            localStorage.setItem("userName",userName);
            window.location.href = "admin/adminStudent.html";    //页面跳转
          }
        }
        ;
        if (result.resultCode == 500){
          swal("登录失败！请检查账号和密码！",{
            icon:"error",
          });
        }
      },
      error:function(){
        swal("接口异常，请联系管理员！",{
          icon:"error",
        });
        return;
      }
    });
  }

  function forgetPassword() {
    swal("请联系教师或管理员",{
      icon:"warning",
    });

  }

  function registered(){
    //隐藏错误提示框
    $('.alert-danger').css("display", "none");
    reset();
    $("#modalRegister").modal('show');
  }

  $('#saveButton').click(function () {
    var userName = $('#userNameNew').val();
    var password = $('#passwordNew').val();
    var studentID = $('#studentIDNew').val();
    var studentSex = $("input[name='userSex']:checked").val();
    var studentClass = $('#studentClassNew').val();
    var data = {"studentName": userName, "studentPassword": password,"studentID":studentID,
      "studentSex":studentSex,"studentClass":studentClass};
    $.ajax({
      type: 'POST',//方法类型
      dataType: "json",//预期服务器返回的数据类型
      url: '../students/save',//url
      contentType: "application/json; charset=utf-8",
      data: JSON.stringify(data),
      success: function (result) {
        if (result.resultCode == 200) {
          swal("注册成功",{
            icon:"success",
          });
          $('#modalRegister').modal('hide');
        }
        else {
          swal(result.message,{
            icon:"error",
          });
        }
        ;
      },
      error: function () {
        swal("操作失败",{
          icon:"error",
        });
      }
    });

  })


  /**
   * 重置 使得上一次输入的内容在重新打开输入框时被清除
   **/
  function reset() {
    $('#userNameNew').val('');
    $('#passwordNew').val('');
    $('#studentClassNew').val('');
    $('#studentIDNew').val('');
    $('#sex1').removeClass("active");
    $('#sex2').removeClass("active");

  }



</script>
</body>
</html>
